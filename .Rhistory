data_num <- data %>%
mutate(across(
where(~ inherits(.x, "Date")),  # is it a Date?
as.numeric
))
# calculate correlations
cor_mat <- cor(data_num, use = "pairwise.complete.obs", method = "pearson")
# turn data into long format
cor_df <- as.data.frame(as.table(cor_mat))
names(cor_df) <- c("Var1", "Var2", "Correlation")
# base heatmap (your old ggplot)
p <- ggplot(cor_df, aes(x = Var1, y = Var2, fill = Correlation)) +
geom_tile() +
scale_fill_gradient2(
limits   = c(-1, 1),
midpoint = 0,
low      = "blue",
mid      = "white",
high     = "red"
) +
coord_fixed() +
theme_minimal() +
theme(
axis.text.x  = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank(),
axis.title.y = element_blank()
) +
ggtitle("Pearson Correlation Heatmap")
# ðŸ”¥ make it interactive
ggplotly(p)
# heatmap
# make a numeric-only version of your data:
data_num <- data %>%
mutate(across(
where(~ inherits(.x, "Date")),  # is it a Date?
as.numeric
))
# Remove columns with zero variance
is_constant <- sapply(data_num, function(x) sd(x, na.rm = TRUE) == 0)
data_num2 <- data_num[, !is_constant]
sum(is_constant)  # just to see how many you removed (optional)
# calculate correlations
cor_mat <- cor(data_num, use = "pairwise.complete.obs", method = "pearson")
# turn data into long format
cor_df <- as.data.frame(as.table(cor_mat))
names(cor_df) <- c("Var1", "Var2", "Correlation")
# base heatmap (your old ggplot)
p <- ggplot(cor_df, aes(x = Var1, y = Var2, fill = Correlation)) +
geom_tile() +
scale_fill_gradient2(
limits   = c(-1, 1),
midpoint = 0,
low      = "blue",
mid      = "white",
high     = "red"
) +
coord_fixed() +
theme_minimal() +
theme(
axis.text.x  = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank(),
axis.title.y = element_blank()
) +
ggtitle("Pearson Correlation Heatmap")
# ðŸ”¥ make it interactive
ggplotly(p)
# heatmap
# make a numeric-only version of your data:
data_num <- data %>%
mutate(across(
where(~ inherits(.x, "Date")),  # <- predicate: is it a Date?
as.numeric
))
# calculate correlations
cor_mat <- cor(data_num, use = "pairwise.complete.obs", method = "pearson")
# turn data into long format
cor_df <- as.data.frame(as.table(cor_mat))
names(cor_df) <- c("Var1", "Var2", "Correlation")
#plot the heatmap
ggplot(cor_df, aes(x = Var1, y = Var2, fill = Correlation)) +
geom_tile() +
scale_fill_gradient2(
limits = c(-1, 1),
midpoint = 0,
low = "blue",
mid = "white",
high = "red"
) +
coord_fixed() +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
axis.title.x = element_blank(),
axis.title.y = element_blank()
) +
ggtitle("Pearson Correlation Heatmap")
# heatmap
# make a numeric-only version of your data:
data_num <- data %>%
mutate(across(
where(~ inherits(.x, "Date")),  # <- predicate: is it a Date?
as.numeric
))
# calculate correlations
cor_mat <- cor(data_num, use = "pairwise.complete.obs", method = "pearson")
library(plotly)
plot_ly(
x = colnames(cor_mat),
y = rownames(cor_mat),
z = cor_mat,
type = "heatmap",
zmin = -1,
zmax = 1,
colorscale = "RdBu",
reversescale = TRUE,
hovertemplate = paste(
"Var1: %{x}<br>",
"Var2: %{y}<br>",
"Correlation: %{z:.2f}<extra></extra>"
)
) %>%
layout(
title = "Pearson Correlation Heatmap",
xaxis = list(title = ""),
yaxis = list(title = "")
)
# heatmap
# make a numeric-only version of your data:
data_num <- data %>%
mutate(across(
where(~ inherits(.x, "Date")),  # <- predicate: is it a Date?
as.numeric
))
# calculate correlations
cor_mat <- cor(data_num, use = "pairwise.complete.obs", method = "pearson")
library(plotly)
# custom redâ€“whiteâ€“blue colorscale: blue (negative) â†’ white (0) â†’ red (positive)
rwb_scale <- list(
list(0.0, "blue"),
list(0.5, "white"),
list(1.0, "red")
)
plot_ly(
x = colnames(cor_mat),
y = rownames(cor_mat),
z = cor_mat,
type = "heatmap",
zmin = -1,
zmax = 1,
colorscale = rwb_scale,
hovertemplate = paste(
"Var1: %{x}<br>",
"Var2: %{y}<br>",
"Correlation: %{z:.2f}<extra></extra>"
)
) %>%
layout(
title = list(
text = "Pearson Correlation Heatmap",
x = 0.5,
xanchor = "center"
),
xaxis = list(
title = "",
tickangle = -45,
tickfont = list(size = 9)
),
yaxis = list(
title = "",
tickfont = list(size = 9,
automargin = TRUE)
),
margin = list(l = 80, r = 20, b = 120, t = 50),
coloraxis = list(
colorbar = list(
title = "r",
ticksuffix = "",
len = 0.8
)
)
)
library(tidyverse)
library(haven)
library(ggplot2)
data <- read_dta("original&computed_DB_forrep.dta")
View(data)
unique(df$team)
unique(data$team)
count(unique(data$team))
n_distinct(data$team)
Players <- n_disntict(data$player)
Players <- n_distinct(data$player)
n_distinct(data$player)
n_distinct(data$played)
n_distinct(data$gamenu)
Strikers <-
Midfielders <-
Defenders <-
n_distinct(data$position == "striker")
Strikers <-
Midfielders <-
Defenders <-
n_distinct(data$position == 4)
Strikers <-
Midfielders <-
Defenders <-
n_distinct(data$position == 4)
n_distinct(data$position == 4)
distinct(data$position == 4)
n_distinct(data$position == "4")
n_distinct(data$position == "1")
n_distinct(data$position == "2")
data %>%
filter(position == 4) %>%
n_distinct()
data %>%
filter(position == 4) %>%
n_distinct(player)
n_distinct(data$player[data$position == 4])
n_distinct(data$player[data$position == 3])
n_distinct(data$player[data$position == 2])
library(tidyverse)
library(haven)
library(ggplot2)
library(dplyr)
library(plotly)
data <- read_dta("original&computed_DB_forrep.dta")
#plot every variable's histogram, since all data is either numeric or date
all_vars <- names(data)
for (v in all_vars) {
print(
ggplot(data, aes_string(x = v)) +
geom_histogram(bins = 30) +
ggtitle(paste("Histogram of", v))
)
}
# heatmap
# make a numeric-only version of your data:
data_num <- data %>%
mutate(across(
where(~ inherits(.x, "Date")),  # <- predicate: is it a Date?
as.numeric
))
# calculate correlations
cor_mat <- cor(data_num, use = "pairwise.complete.obs", method = "pearson")
library(plotly)
# custom redâ€“whiteâ€“blue colorscale: blue (negative) â†’ white (0) â†’ red (positive)
rwb_scale <- list(
list(0.0, "blue"),
list(0.5, "white"),
list(1.0, "red")
)
plot_ly(
x = colnames(cor_mat),
y = rownames(cor_mat),
z = cor_mat,
type = "heatmap",
zmin = -1,
zmax = 1,
colorscale = rwb_scale,
hovertemplate = paste(
"Var1: %{x}<br>",
"Var2: %{y}<br>",
"Correlation: %{z:.2f}<extra></extra>"
)
) %>%
layout(
title = list(
text = "Pearson Correlation Heatmap",
x = 0.5,
xanchor = "center"
),
xaxis = list(
title = "",
tickangle = -45,
tickfont = list(size = 9)
),
yaxis = list(
title = "",
tickfont = list(size = 9,
automargin = TRUE)
),
margin = list(l = 80, r = 20, b = 120, t = 50),
coloraxis = list(
colorbar = list(
title = "r",
ticksuffix = "",
len = 0.8
)
)
)
View(data)
mean(data$dfullsection)
round(mean(data$dfullsection),2)
round(mean(data$dpartsection),2)
data$section %in% c(10, 20)
mean(data$section %in% c(10, 20))
round(mean(data$section %in% c(10, 20)),2)
nrow(data)
data %>% group_by(team) %>% nrow()
data %>% group_by(team) %>% nrow()
data %>% count(team)
data %>%
distinct(team, section) %>%
nrow()
data %>%
distinct(team, section) %>%
count(team)
View(data)
nrow(data)/14
#Panel A: Section Level
Full_Sections <- round(mean(data$dfullsection),2)
Overtime_Sections <- round(mean(data$section %in% c(10, 20)),2)
Players_Distance <-
Players_Sprints <-
SMGP <-
Team_Distance <-
Observations1 <- nrow(data)
Observations2 <-
#Panel B
#
Rounds <- n_distinct(data$played)
Games <- n_distinct(data$gamenu)
Teams <- n_distinct(data$team)
Players <- n_distinct(data$player)
Strikers <- n_distinct(data$player[data$position == 4])
Midfielders <- n_distinct(data$player[data$position == 3])
Defenders <- n_distinct(data$player[data$position == 2])
library(tidyverse)
library(haven)
library(ggplot2)
library(dplyr)
library(plotly)
library(tidyr)
library(xtable)
library(knitr)
library(kableExtra)
data <- read_dta("original&computed_DB_forrep.dta")
# sort the columns to be alphabetically ordered
data <- data[, order(names(data))]
# change dates to Date type
data$bdate <- as.Date(data$bdate, format = "%Y-%m-%d")
data$joineddate <- as.Date(data$joineddate, format = "%Y-%m-%d")
# Count of NAs per column
colSums(is.na(data))
# Percentage of missing values
colSums(is.na(data)) / nrow(data) * 100
View(data)
### --------------------------------------------------------------
### PANEL A: Section level
### --------------------------------------------------------------
panelA_vars <- list(
full_sections                = "dfullsection",
#  overtime_sections            = "placeholder",      sind das nicht einfach static 0.1?
player_distance              = "playerdist",
player_sprints               = "playersprints",
goal_probability             = "SMGP",
team_distance                = "teamdist"
)
panelA <- data %>%
summarise(
FullSections_mean     = mean(dfullsection, na.rm = TRUE),
# Overtime_mean         = mean(, na.rm = TRUE),
PlayerDistance_mean   = mean(playerdist, na.rm = TRUE),
PlayerDistance_sd     = sd(playerdist, na.rm = TRUE),
PlayerSprints_mean    = mean(playersprints, na.rm = TRUE),
PlayerSprints_sd      = sd(playersprints, na.rm = TRUE),
GoalProb_mean         = mean(SMGP, na.rm = TRUE),
GoalProb_sd           = sd(SMGP, na.rm = TRUE),
TeamDistance_mean     = mean(teamdist, na.rm = TRUE),
TeamDistance_sd       = sd(teamdist, na.rm = TRUE),
Observations_PS       = nrow(data_base),
Observations_TS       = TG_combinations*20         #18 oder 20?
)
data <- data %>%
mutate(
SMGP = ifelse(position %in% c(3,4),          # SMGP = Strikers and midfielders goal probability
dplagoal,                      # already 0/1 if player scored
NA)                            # set others to NA
)
### --------------------------------------------------------------
### PANEL A: Section level
### --------------------------------------------------------------
panelA_vars <- list(
full_sections                = "dfullsection",
#  overtime_sections            = "placeholder",      sind das nicht einfach static 0.1?
player_distance              = "playerdist",
player_sprints               = "playersprints",
goal_probability             = "SMGP",
team_distance                = "teamdist"
)
panelA <- data %>%
summarise(
FullSections_mean     = mean(dfullsection, na.rm = TRUE),
# Overtime_mean         = mean(, na.rm = TRUE),
PlayerDistance_mean   = mean(playerdist, na.rm = TRUE),
PlayerDistance_sd     = sd(playerdist, na.rm = TRUE),
PlayerSprints_mean    = mean(playersprints, na.rm = TRUE),
PlayerSprints_sd      = sd(playersprints, na.rm = TRUE),
GoalProb_mean         = mean(SMGP, na.rm = TRUE),
GoalProb_sd           = sd(SMGP, na.rm = TRUE),
TeamDistance_mean     = mean(teamdist, na.rm = TRUE),
TeamDistance_sd       = sd(teamdist, na.rm = TRUE),
Observations_PS       = nrow(data_base),
Observations_TS       = TG_combinations*20         #18 oder 20?
)
### --------------------------------------------------------------
### PANEL A: Section level
### --------------------------------------------------------------
panelA_vars <- list(
full_sections                = "dfullsection",
#  overtime_sections            = "placeholder",      sind das nicht einfach static 0.1?
player_distance              = "playerdist",
player_sprints               = "playersprints",
goal_probability             = "SMGP",
team_distance                = "teamdist"
)
panelA <- data %>%
summarise(
FullSections_mean     = mean(dfullsection, na.rm = TRUE),
# Overtime_mean         = mean(, na.rm = TRUE),
PlayerDistance_mean   = mean(playerdist, na.rm = TRUE),
PlayerDistance_sd     = sd(playerdist, na.rm = TRUE),
PlayerSprints_mean    = mean(playersprints, na.rm = TRUE),
PlayerSprints_sd      = sd(playersprints, na.rm = TRUE),
GoalProb_mean         = mean(SMGP, na.rm = TRUE),
GoalProb_sd           = sd(SMGP, na.rm = TRUE),
TeamDistance_mean     = mean(teamdist, na.rm = TRUE),
TeamDistance_sd       = sd(teamdist, na.rm = TRUE),
Observations_PS       = nrow(data),
Observations_TS       = TG_combinations*20         #18 oder 20?
)
# unique combinations of team and games
TG_combinations <- data %>%
distinct(team, gamenu) %>%
nrow()
TG_combinations
team_game_redcards <- data %>%
group_by(team, gamenu) %>%
summarise(
redcard_teamgame = as.integer(any(dplaredc == 1)),
.groups = "drop"
)
### --------------------------------------------------------------
### PANEL A: Section level
### --------------------------------------------------------------
panelA_vars <- list(
full_sections                = "dfullsection",
#  overtime_sections            = "placeholder",      sind das nicht einfach static 0.1?
player_distance              = "playerdist",
player_sprints               = "playersprints",
goal_probability             = "SMGP",
team_distance                = "teamdist"
)
panelA <- data %>%
summarise(
FullSections_mean     = mean(dfullsection, na.rm = TRUE),
# Overtime_mean         = mean(, na.rm = TRUE),
PlayerDistance_mean   = mean(playerdist, na.rm = TRUE),
PlayerDistance_sd     = sd(playerdist, na.rm = TRUE),
PlayerSprints_mean    = mean(playersprints, na.rm = TRUE),
PlayerSprints_sd      = sd(playersprints, na.rm = TRUE),
GoalProb_mean         = mean(SMGP, na.rm = TRUE),
GoalProb_sd           = sd(SMGP, na.rm = TRUE),
TeamDistance_mean     = mean(teamdist, na.rm = TRUE),
TeamDistance_sd       = sd(teamdist, na.rm = TRUE),
Observations_PS       = nrow(data),
Observations_TS       = TG_combinations*20         #18 oder 20?
)
panelA <- panelA %>%
pivot_longer(
cols = everything(),
names_to = "Variable",
values_to = "Value"
)
View(panelA)
### --------------------------------------------------------------
### PANEL B: Game level
### --------------------------------------------------------------
panelB <- data %>%
summarise(
SectionsPlayed_mean   = mean(player_sectionsplayed, na.rm = TRUE),
SectionsPlayed_sd     = sd(player_sectionsplayed, na.rm = TRUE),
AvgSpeed_mean         = mean(plaavspeed_game, na.rm = TRUE),
AvgSpeed_sd           = sd(plaavspeed_game, na.rm = TRUE),
TeamDistanceGame_mean = mean(teamdist_game, na.rm = TRUE),
TeamDistanceGame_sd   = sd(teamdist_game, na.rm = TRUE),
HomeCrowd_mean        = mean(team_crowd, na.rm = TRUE),
HomeCrowd_sd          = sd(team_crowd, na.rm = TRUE),
AwayCrowd_mean        = mean(opp_crowd, na.rm = TRUE),
AwayCrowd_sd          = sd(opp_crowd, na.rm = TRUE),
RedCardProb_mean      = mean(team_game_redcards$redcard_teamgame),
RedCardProb_sd        = sd(team_game_redcards$redcard_teamgame),
Obs_player_game       = Obs_player_game <- data %>%
distinct(player, gamenu) %>%
nrow(),
Obs_team_game         = n_distinct(team, gamenu),
Rounds                = n_distinct(played),
Games                 = n_distinct(gamenu),
Teams                 = n_distinct(team),
Players               = n_distinct(player),
Strikers              = data %>% filter(position == "4") %>% distinct(player) %>% nrow(),
Midfielders           = data %>% filter(position == "3") %>% distinct(player) %>% nrow(),
Defenders             = data %>% filter(position == "2") %>% distinct(player) %>% nrow()
)
panelB <- panelB %>%
pivot_longer(
cols = everything(),
names_to = "Variable",
values_to = "Value"
)
View(panelB)
