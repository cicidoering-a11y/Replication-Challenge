---
title: "Replication Challenge"
author: "Lisa Philine Krämer"
date: "2025-11-20"
output: html_document
---
```{r}
library(tidyverse)
library(haven)
library(ggplot2)
library(dplyr)
library(plotly)
```



```{r}
data <- read_dta("original&computed_DB_forrep.dta")
```

```{r}
# sort the columns to be alphabetically ordered
data <- data[, order(names(data))]

# change dates to Date type 
data$bdate <- as.Date(data$bdate, format = "%Y-%m-%d")
data$joineddate <- as.Date(data$joineddate, format = "%Y-%m-%d")
```


```{r}
summary(data)
```
```{r}
data %>%
  keep(is.numeric) %>%                     # Keep only numeric columns
  gather() %>%                             # Convert to key-value pairs
  ggplot(aes(value)) +                     # Plot the values
    facet_wrap(~ key, scales = "free") +   # In separate panels
    geom_histogram() 
```


```{r}
# Count of NAs per column
colSums(is.na(data))

# Percentage of missing values
colSums(is.na(data)) / nrow(data) * 100

```

```{r}
#plot every variable's histogram, since all data is either numeric or date

all_vars <- names(data)

for (v in all_vars) {
  print(
    ggplot(data, aes_string(x = v)) +
      geom_histogram(bins = 30) +
      ggtitle(paste("Histogram of", v))
  )
}


```
```{r}
# heatmap


# make a numeric-only version of your data:
data_num <- data %>%
  mutate(across(
    where(~ inherits(.x, "Date")),  # <- predicate: is it a Date?
    as.numeric
  ))

# calculate correlations
cor_mat <- cor(data_num, use = "pairwise.complete.obs", method = "pearson")

library(plotly)

# custom red–white–blue colorscale: blue (negative) → white (0) → red (positive)
rwb_scale <- list(
  list(0.0, "blue"),
  list(0.5, "white"),
  list(1.0, "red")
)

plot_ly(
  x = colnames(cor_mat),
  y = rownames(cor_mat),
  z = cor_mat,
  type = "heatmap",
  zmin = -1,
  zmax = 1,
  colorscale = rwb_scale,
  hovertemplate = paste(
    "Var1: %{x}<br>",
    "Var2: %{y}<br>",
    "Correlation: %{z:.2f}<extra></extra>"
  )
) %>%
  layout(
    title = list(
      text = "Pearson Correlation Heatmap",
      x = 0.5,
      xanchor = "center"
    ),
    xaxis = list(
      title = "",
      tickangle = -45,
      tickfont = list(size = 9)
    ),
    yaxis = list(
      title = "",
      tickfont = list(size = 9,
                      automargin = TRUE)
    ),
    margin = list(l = 80, r = 20, b = 120, t = 50),
    coloraxis = list(
      colorbar = list(
        title = "r",
        ticksuffix = "",
        len = 0.8
      )
    )
  )


```

Table 1
```{r}
#Panel A: Section Level
Full_Sections <- round(mean(data$dfullsection),2)
Overtime_Sections <- round(mean(data$section %in% c(10, 20)),2)
Players_Distance <-
Players_Sprints <-
SMGP <- 
Team_Distance <-
Observations1 <- nrow(data)
Observations2 <-

#Panel B



#
Rounds <- n_distinct(data$played)
Games <- n_distinct(data$gamenu)
Teams <- n_distinct(data$team)
Players <- n_distinct(data$player)
Strikers <- n_distinct(data$player[data$position == 4])
Midfielders <- n_distinct(data$player[data$position == 3])
Defenders <- n_distinct(data$player[data$position == 2])

```



