---
title: "Replication Challenge"
author: "Lisa Philine Krämer"
date: "2025-11-20"
output: html_document
---
```{r}
library(tidyverse)
library(haven)
library(ggplot2)
library(dplyr)
library(plotly)
library(tidyr)
library(xtable)
library(knitr)
library(kableExtra)
```



```{r}
data <- read_dta("original&computed_DB_forrep.dta")
```

```{r}
# sort the columns to be alphabetically ordered
data <- data[, order(names(data))]

# change dates to Date type 
data$bdate <- as.Date(data$bdate, format = "%Y-%m-%d")
data$joineddate <- as.Date(data$joineddate, format = "%Y-%m-%d")
```


```{r}
summary(data)
```
```{r}
data %>%
  keep(is.numeric) %>%                     # Keep only numeric columns
  gather() %>%                             # Convert to key-value pairs
  ggplot(aes(value)) +                     # Plot the values
    facet_wrap(~ key, scales = "free") +   # In separate panels
    geom_histogram() 
```


```{r}
# Count of NAs per column
colSums(is.na(data))

# Percentage of missing values
colSums(is.na(data)) / nrow(data) * 100

```

```{r}
#plot every variable's histogram, since all data is either numeric or date

all_vars <- names(data)

for (v in all_vars) {
  print(
    ggplot(data, aes_string(x = v)) +
      geom_histogram(bins = 30) +
      ggtitle(paste("Histogram of", v))
  )
}


```
```{r}
# heatmap


# make a numeric-only version of your data:
data_num <- data %>%
  mutate(across(
    where(~ inherits(.x, "Date")),  # <- predicate: is it a Date?
    as.numeric
  ))

# calculate correlations
cor_mat <- cor(data_num, use = "pairwise.complete.obs", method = "pearson")

library(plotly)

# custom red–white–blue colorscale: blue (negative) → white (0) → red (positive)
rwb_scale <- list(
  list(0.0, "blue"),
  list(0.5, "white"),
  list(1.0, "red")
)

plot_ly(
  x = colnames(cor_mat),
  y = rownames(cor_mat),
  z = cor_mat,
  type = "heatmap",
  zmin = -1,
  zmax = 1,
  colorscale = rwb_scale,
  hovertemplate = paste(
    "Var1: %{x}<br>",
    "Var2: %{y}<br>",
    "Correlation: %{z:.2f}<extra></extra>"
  )
) %>%
  layout(
    title = list(
      text = "Pearson Correlation Heatmap",
      x = 0.5,
      xanchor = "center"
    ),
    xaxis = list(
      title = "",
      tickangle = -45,
      tickfont = list(size = 9)
    ),
    yaxis = list(
      title = "",
      tickfont = list(size = 9,
                      automargin = TRUE)
    ),
    margin = list(l = 80, r = 20, b = 120, t = 50),
    coloraxis = list(
      colorbar = list(
        title = "r",
        ticksuffix = "",
        len = 0.8
      )
    )
  )


```

Table 1
```{r}
#Panel A: Section Level
Full_Sections <- round(mean(data$dfullsection),2)
Overtime_Sections <- round(mean(data$section %in% c(10, 20)),2)
Players_Distance <-
Players_Sprints <-
SMGP <- 
Team_Distance <-
Observations1 <- nrow(data)
Observations2 <-

#Panel B



#
Rounds <- n_distinct(data$played)
Games <- n_distinct(data$gamenu)
Teams <- n_distinct(data$team)
Players <- n_distinct(data$player)
Strikers <- n_distinct(data$player[data$position == 4])
Midfielders <- n_distinct(data$player[data$position == 3])
Defenders <- n_distinct(data$player[data$position == 2])

```

#Table 2
```{r}
#daten neu laden weil positions variable weg ist
data <- read_dta("original&computed_DB_forrep.dta")
```

```{r}
#preparation 
library(dplyr)
library(tidyr)
library(brms)
```

```{r}
#set global weakly informative priors that fit (logit) scale (gelten erstmal nur für m1)
priors_t2 <- c(
  set_prior("normal(-4.62, 1)", class = "Intercept"),        # an Beobachtung orientiert
  set_prior("normal(0, 0.5)", class = "b", coef = "plaavspeed_c"), # Hauptprädiktor etwas informativ
  set_prior("normal(0, 0.5)", class = "b")                   # breit(er) für alle anderen b
)
```
##Prepare Data Sets
```{r}
data_base <- data %>%
  filter(
    dfullsection == 1,          # full sections only
    position %in% c(3, 4),      # midfielders + strikers
    !(section %in% c(10, 20)) 
  )
data_base <- data_base  %>% mutate(player = factor(player),
                                    gamenu = factor(gamenu),
                                    section = factor(section))
```

## Summary Statistics

Define missing variable

```{r}
data_base <- data_base %>%
  mutate(
    SMGP = ifelse(position %in% c(3,4),          # SMGP = Strikers and midfielders goal probability
                  dplagoal,                      # already 0/1 if player scored
                  NA)                            # set others to NA
  )
```

```{r}
# unique combinations of team and games
TG_combinations <- data_base %>%
     distinct(team, gamenu) %>%
     nrow()
 
TG_combinations
```
```{r}
team_game_redcards <- data_base %>%
  group_by(team, gamenu) %>%
  summarise(
    redcard_teamgame = as.integer(any(dplaredc == 1)),
    .groups = "drop"
  )

```



```{r}
### --------------------------------------------------------------
### PANEL A: Section level
### --------------------------------------------------------------

panelA_vars <- list(
  full_sections                = "dfullsection",
  overtime_sections            = "(data$section %in% c(10, 20)),2)",
  player_distance              = "playerdist",
  player_sprints               = "playersprints",
  goal_probability             = "SMGP",
  team_distance                = "teamdist"
)

panelA <- data_base %>% 
  summarise(
    FullSections_mean     = mean(dfullsection, na.rm = TRUE),
    Overtime_mean         = round(mean(data$section %in% c(10, 20)),2),
    PlayerDistance_mean   = mean(playerdist, na.rm = TRUE),
    PlayerDistance_sd     = sd(playerdist, na.rm = TRUE),
    PlayerSprints_mean    = mean(playersprints, na.rm = TRUE),
    PlayerSprints_sd      = sd(playersprints, na.rm = TRUE),
    GoalProb_mean         = mean(SMGP, na.rm = TRUE),
    GoalProb_sd           = sd(SMGP, na.rm = TRUE),
    TeamDistance_mean     = mean(teamdist, na.rm = TRUE),
    TeamDistance_sd       = sd(teamdist, na.rm = TRUE),
    Observations_PS       = nrow(data_base),
    Observations_TS       = TG_combinations*20         #18 oder 20?
  )

options(scipen = 999)
panelA <- panelA %>%
  pivot_longer(
    cols = everything(),
    names_to = "Variable",
    values_to = "Value"
  )
 
```




```{r}
### --------------------------------------------------------------
### PANEL B: Game level
### --------------------------------------------------------------

panelB <- data_base %>% 
  summarise(
    SectionsPlayed_mean   = mean(player_sectionsplayed, na.rm = TRUE),
    SectionsPlayed_sd     = sd(player_sectionsplayed, na.rm = TRUE),
    AvgSpeed_mean         = mean(plaavspeed_game, na.rm = TRUE),
    AvgSpeed_sd           = sd(plaavspeed_game, na.rm = TRUE),
    TeamDistanceGame_mean = mean(teamdist_game, na.rm = TRUE),
    TeamDistanceGame_sd   = sd(teamdist_game, na.rm = TRUE),
    HomeCrowd_mean        = mean(team_crowd, na.rm = TRUE),
    HomeCrowd_sd          = sd(team_crowd, na.rm = TRUE),
    AwayCrowd_mean        = mean(opp_crowd, na.rm = TRUE),
    AwayCrowd_sd          = sd(opp_crowd, na.rm = TRUE),
    RedCardProb_mean      = mean(team_game_redcards$redcard_teamgame),
    RedCardProb_sd        = sd(team_game_redcards$redcard_teamgame),
    Obs_player_game       = Obs_player_game <- data_base %>%
                            distinct(player, gamenu) %>%
                            nrow(),
    Obs_team_game         = n_distinct(team, gamenu),
    Rounds                = n_distinct(played),
    Games                 = n_distinct(gamenu),
    Teams                 = n_distinct(team),
    Players               = n_distinct(player),
    Strikers              = data_base %>% filter(position == "4") %>% distinct(player) %>% nrow(),
    Midfielders           = data_base %>% filter(position == "3") %>% distinct(player) %>% nrow(),
    Defenders             = data_base %>% filter(position == "2") %>% distinct(player) %>% nrow()
  )

panelB <- panelB %>%
  pivot_longer(
    cols = everything(),
    names_to = "Variable",
    values_to = "Value"
  )
```

## Latex code for summary statistics
```{r}
### PANEL A Latex code
panelA_latex <- kable(panelA, 
                      format = "latex", 
                      booktabs = TRUE, 
                      caption = "Panel A: Section LeveL") %>%
  kable_styling(latex_options = c("hold_position", "scale_down"))

# Print Latex code
cat(panelA_latex)

### PANEL B Latex code
panelB_latex <- kable(panelB, 
                      format = "latex", 
                      booktabs = TRUE, 
                      caption = "Panel B: Game Level") %>%
  kable_styling(latex_options = c("hold_position", "scale_down"))

# Print Latex code
cat(panelB_latex)
```









```{r}
data_col1 <- data_base %>%
  drop_na(dplagoal, plaavspeed) %>%
  mutate(
    plaavspeed_c = plaavspeed - mean(plaavspeed, na.rm = TRUE)
  )
```

```{r}
data_col2 <- data_base %>%
  drop_na(
    dplagoal, plaavspeed,
    dhomegame, rank_gap,
    player_cumsections, player_cumsections_2
  ) %>%
  mutate(
    plaavspeed_c           = plaavspeed - mean(plaavspeed, na.rm = TRUE),
    rank_gap_c             = rank_gap - mean(rank_gap, na.rm = TRUE),
    player_cumsections_c   = player_cumsections - mean(player_cumsections, na.rm = TRUE),
    player_cumsections_2_c = player_cumsections_2 - mean(player_cumsections_2, na.rm = TRUE)
  )

```

```{r}
data_col356 <- data_base %>%
  drop_na(
    dplagoal, plaavspeed, playersprints,
    dhomegame, rank_gap,
    player_cumsections, player_cumsections_2,
    scoregap_pre, dteamgoal_pre, dplagoal_pre,
    dteamred_pre, dteaminj_sec_pre,
    team_avespeed_pre
  ) %>%
  mutate(
    plaavspeed_c           = plaavspeed - mean(plaavspeed, na.rm = TRUE),
    playersprints_c        = playersprints - mean(playersprints, na.rm = TRUE),
    rank_gap_c             = rank_gap - mean(rank_gap, na.rm = TRUE),
    player_cumsections_c   = player_cumsections - mean(player_cumsections, na.rm = TRUE),
    player_cumsections_2_c = player_cumsections_2 - mean(player_cumsections_2, na.rm = TRUE),
    scoregap_pre_c         = scoregap_pre - mean(scoregap_pre, na.rm = TRUE),
    team_avespeed_pre_c    = team_avespeed_pre - mean(team_avespeed_pre, na.rm = TRUE)
  )
```

```{r}
data_col4 <- data_base %>%
  drop_na(
    dplagoal, plaavspeed,
    dhomegame, rank_gap,
    player_cumsections, player_cumsections_2,
    scoregap_pre, dteamgoal_pre, dplagoal_pre,
    dteamred_pre, dteaminj_sec_pre,
    team_avespeed_pre,
    team_crowd, opp_crowd,
    p_odds_team, p_odds_draw
  ) %>%
  mutate(
    plaavspeed_c           = plaavspeed - mean(plaavspeed, na.rm = TRUE),
    rank_gap_c             = rank_gap - mean(rank_gap, na.rm = TRUE),
    player_cumsections_c   = player_cumsections - mean(player_cumsections, na.rm = TRUE),
    player_cumsections_2_c = player_cumsections_2 - mean(player_cumsections_2, na.rm = TRUE),
    scoregap_pre_c         = scoregap_pre - mean(scoregap_pre, na.rm = TRUE),
    team_avespeed_pre_c    = team_avespeed_pre - mean(team_avespeed_pre, na.rm = TRUE),
    team_crowd_c           = team_crowd - mean(team_crowd, na.rm = TRUE),
    opp_crowd_c            = opp_crowd - mean(opp_crowd, na.rm = TRUE),
    p_odds_team_c          = p_odds_team - mean(p_odds_team, na.rm = TRUE),
    p_odds_draw_c          = p_odds_draw - mean(p_odds_draw, na.rm = TRUE)
  )

```

```{r}
#check if n matches table
nrow(data_col1)
nrow(data_col2)
nrow(data_col356) #unterschieded sich um 2, müsste aber eig gleich sein
nrow(data_col4)
```

##Column 1
```{r}
m_col1_prior <- brm(
  dplagoal ~ plaavspeed_c +
    factor(player) +      
    factor(gamenu) +     
    factor(section), 
  data    = data_col1,
  family  = bernoulli(link = "logit"),
  sample_prior = "only",
  prior   = priors_t2,
  iter    = 1000, warmup = 500, chains = 4, cores = 4
)
```

```{r}
#prior checks
pp_check(m_col1_prior, ndraws = 50)          
yrep_small <- posterior_predict(m_col1_prior, ndraws = 100)
hist(rowMeans(yrep_small))
plot(m_col1_prior, N = 1000)                             
```


```{r}
m_col1 <- brm(
  dplagoal ~ plaavspeed_c +
    factor(player) +      
    factor(gamenu) +     
    factor(section),     
  data    = data_col1,
  family  = bernoulli(link = "logit"),
  prior   = priors_t2,
  iter    = 1000, warmup = 500, chains = 4, cores = 4
)
```

```{r}
summary(m_col1)
pp_check(m_col1, ndraws = 100)
conditional_effects(m_col1, spaghetti = TRUE, ndraws = 200)
plot(m_col1)
```

##Column 2
```{r}
priors_col2 <- c(
  # baseline scoring probability ≈ 1%
  set_prior("normal(-4.6, 0.5)", class = "Intercept"),
  
  # main covariates
  set_prior("normal(0, 0.35)", class = "b", coef = "plaavspeed_c"),
  set_prior("normal(0, 0.5)",  class = "b", coef = "dhomegame"),
  set_prior("normal(0, 0.05)", class = "b", coef = "rank_gap_c"),
  set_prior("normal(0, 0.05)", class = "b", coef = "player_cumsections_c"),
  set_prior("normal(0, 0.005)",class = "b", coef = "player_cumsections_2_c"),
  
  # default for everything else (all those factor dummies)
  set_prior("normal(0, 0.8)", class = "b")
)
```


```{r}
m_col2_prior <- brm(
  dplagoal ~ plaavspeed_c +
    dhomegame +
    rank_gap_c +
    player_cumsections_c + player_cumsections_2_c +
    factor(player) +      
    factor(gamenu) +     
    factor(section), 
    sample_prior = "only",
  data    = data_col2,
  family  = bernoulli(link = "logit"),
  prior   = priors_col2,
  iter    = 1000, warmup = 500, chains = 4, cores = 4
)

```

```{r}
#prior checks
pp_check(m_col2_prior, ndraws = 50)          
yrep_small2 <- posterior_predict(m_col2_prior, ndraws = 100)
hist(rowMeans(yrep_small2))
plot(m_col2_prior, N = 1000)                               
```

```{r}
m_col2 <- brm(
  dplagoal ~ plaavspeed_c +
    dhomegame +
    rank_gap_c +
    player_cumsections_c + player_cumsections_2_c +
    factor(player) +      
    factor(gamenu) +     
    factor(section), 
    #sample_prior = "only",
  data    = data_col2,
  family  = bernoulli(link = "logit"),
  prior   = priors_col2,
  iter    = 2000, warmup = 1000, chains = 4, cores = 4
)

```

##Column 3
```{r}
m_col3 <- brm(
  dplagoal ~
    plaavspeed_c +
    dhomegame + rank_gap_c +
    player_cumsections_c + player_cumsections_2_c +
    scoregap_pre_c + dteamgoal_pre + dplagoal_pre +
    dteamred_pre + dteaminj_sec_pre +
    team_avespeed_pre_c +
    factor(player) +      
    factor(gamenu) +     
    factor(section), 
  data    = data_col3,
  family  = bernoulli(link = "logit"),
  prior   = priors_t2,
  chains  = 4, iter = 2000, warmup = 1000, cores = 4
)
```

##Column 4
```{r}
m_col4 <- brm(
  dplagoal ~
    plaavspeed_c +
    dhomegame + rank_gap_c +
    player_cumsections_c + player_cumsections_2_c +
    scoregap_pre_c + dteamgoal_pre + dplagoal_pre +
    dteamred_pre + dteaminj_sec_pre +
    team_avespeed_pre_c +
    team_crowd_c + opp_crowd_c +
    p_odds_team_c + p_odds_draw_c +
    factor(player) +      
    factor(gamenu) +     
    factor(section), 
  data    = data_col4,
  family  = bernoulli(link = "logit"),
  prior   = priors_t2,
  chains  = 4, iter = 2000, warmup = 1000, cores = 4
)
```

##Column 5
```{r}
m_col5 <- brm(
  dplagoal ~
    playersprints_c +
    dhomegame + rank_gap_c +
    player_cumsections_c + player_cumsections_2_c +
    scoregap_pre_c + dteamgoal_pre + dplagoal_pre +
    dteamred_pre + dteaminj_sec_pre +
    team_avespeed_pre_c +
    factor(player) +      
    factor(gamenu) +     
    factor(section), 
  data    = data_col356,
  family  = bernoulli(link = "logit"),
  prior   = priors_t2,
  chains  = 4, iter = 2000, warmup = 1000, cores = 4
)
```

##Column 6
```{r}
m_col6 <- brm(
  dplagoal ~
    plaavspeed_c + playersprints_c +
    dhomegame + rank_gap_c +
    player_cumsections_c + player_cumsections_2_c +
    scoregap_pre_c + dteamgoal_pre + dplagoal_pre +
    dteamred_pre + dteaminj_sec_pre +
    team_avespeed_pre_c +
    factor(player) +      
    factor(gamenu) +     
    factor(section), 
  data    = data_col356,
  family  = bernoulli(link = "logit"),
  prior   = priors_t2,
  chains  = 4, iter = 2000, warmup = 1000, cores = 4
)
```

##Column 7:
```{r}
# Aggregation auf Spieler × Spiel
data_col7 <- data_base %>%
  group_by(player, gamenu) %>%
  summarise(
    # Ziel: hat der Spieler in diesem Spiel mindestens 1 Tor?
    goal_game = as.integer(any(dplagoal == 1)),

    # durchschnittliche Geschwindigkeit im Spiel
    plaavspeed_game = first(plaavspeed_game),

    # Controls, die auf Spiel-Ebene konstant sind
    dhomegame = first(dhomegame),
    rank_gap  = first(rank_gap),
    .groups = "drop"
  ) %>%
  # fehlende Werte löschen
  drop_na(goal_game, plaavspeed_game, dhomegame, rank_gap) %>%
  # Zentrierung der Prädiktoren (wie bei den anderen Spalten)
  mutate(
    plaavspeed_game_c = plaavspeed_game - mean(plaavspeed_game, na.rm = TRUE),
    rank_gap_c        = rank_gap - mean(rank_gap, na.rm = TRUE)
  )
```

```{r}
m_col7 <- brm(
  formula = goal_game ~ plaavspeed_game_c + dhomegame + rank_gap_c +
    factor(player) +      
    factor(gamenu), 
  data    = data_col7,
  family  = bernoulli(link = "logit"),
  prior   = priors_t2,
  chains  = 4, iter = 2000, warmup = 1000, cores = 4
)

```



# hierarchical logistic models
```{r}
# Base priors
priors_base <- c(
  set_prior("normal(-4.6, 0.3)", class = "Intercept"),
  set_prior("normal(0, 0.5)", class = "b"),
  set_prior("normal(0, 0.4)", class = "sd", group = "player", lb = 0),
  set_prior("normal(0, 0.4)", class = "sd", group = "gamenu", lb = 0),
  set_prior("normal(0, 0.4)", class = "sd", group = "section", lb = 0)
)


# Column-specific priors
priors_col1 <- c(
  priors_base,
  set_prior("normal(0, 0.4)", class = "b", coef = "plaavspeed_c")
)

priors_col2 <- c(
  priors_base,
  set_prior("normal(0, 0.4)", class = "b", coef = "plaavspeed_c")
)

priors_col3 <- c(
  priors_base,
  set_prior("normal(0, 0.4)", class = "b", coef = "plaavspeed_c")
)

priors_col4 <- c(
  priors_base,
  set_prior("normal(0, 0.4)", class = "b", coef = "plaavspeed_c")
)

priors_col5 <- c(
  priors_base,
  set_prior("normal(0, 0.4)", class = "b", coef = "playersprints_c")
)

priors_col6 <- c(
  priors_base,
  set_prior("normal(0, 0.4)", class = "b", coef = "plaavspeed_c"),
  set_prior("normal(0, 0.4)", class = "b", coef = "playersprints_c")
)

priors_base_col7 <- c(
  set_prior("normal(-4.6, 1)", class = "Intercept"),
  set_prior("normal(0, 0.5)", class = "b"),
  set_prior("student_t(3, 0, 1)", class = "sd", group = "player"),
  set_prior("student_t(3, 0, 1)", class = "sd", group = "gamenu")
)

priors_col7 <- c(
  priors_base_col7,
  set_prior("normal(0, 0.4)", class = "b", coef = "plaavspeed_game_c")
)

```

```{r}
m_col1_hier_prior <- brm(
  dplagoal ~ plaavspeed_c +
    (1 | player) +        
    (1 | gamenu) +        
    (1 | section),        
  data          = data_col1,
  family        = bernoulli(link = "logit"),
  prior         = priors_col1,
  sample_prior  = "only",
  iter          = 2000, 
  warmup        = 1000,
  chains        = 4,
  cores         = 4
)
```

```{r}
pp_check(m_col1_hier_prior, ndraws = 50)
hist(rowMeans(posterior_predict(m_col1_hier_prior, ndraws = 100)))
plot(m_col1_hier_prior)
```


```{r}
m_col1_hier <- brm(
  dplagoal ~ plaavspeed_c +
    (1 | player) +
    (1 | gamenu) +
    (1 | section),
  data         = data_col1,
  family       = bernoulli(link = "logit"),
  prior        = priors_col1,
  sample_prior = "no",
  iter         = 1000,
  warmup       = 500,
  chains       = 4,
  cores        = 4
)
```

```{r}
summary(m_col1_hier)
pp_check(m_col1_hier, ndraws = 100)
conditional_effects(m_col1_hier, spaghetti = TRUE, ndraws = 200)
plot(m_col1_hier)
```

```{r}
m_col2_hier <- brm(
  dplagoal ~ plaavspeed_c +
    dhomegame +
    rank_gap_c +
    player_cumsections_c + player_cumsections_2_c +
    (1 | player) +
    (1 | gamenu) +
    (1 | section),
  data    = data_col2,
  family  = bernoulli(link = "logit"),
  prior   = priors_col2,
  chains  = 4, iter = 2000, warmup = 1000, cores = 4
)
```

```{r}
summary(m_col2_hier)
pp_check(m_col2_hier, ndraws = 100)
conditional_effects(m_col2_hier, spaghetti = TRUE, ndraws = 200)
plot(m_col2_hier)
```

```{r}
m_col3_hier <- brm(
  dplagoal ~
    plaavspeed_c +
    dhomegame + rank_gap_c +
    player_cumsections_c + player_cumsections_2_c +
    scoregap_pre_c + dteamgoal_pre + dplagoal_pre +
    dteamred_pre + dteaminj_sec_pre +
    team_avespeed_pre_c +
    (1 | player) +
    (1 | gamenu) +
    (1 | section),
  data    = data_col356,
  family  = bernoulli(link = "logit"),
  prior   = priors_col3,
  chains  = 4, iter = 2000, warmup = 1000, cores = 4
)
```

```{r}
summary(m_col3_hier)
pp_check(m_col3_hier, ndraws = 100)
conditional_effects(m_col3_hier, spaghetti = TRUE, ndraws = 200)
plot(m_col3_hier)
```

```{r}
m_col4_hier <- brm(
  dplagoal ~
    plaavspeed_c +
    dhomegame + rank_gap_c +
    player_cumsections_c + player_cumsections_2_c +
    scoregap_pre_c + dteamgoal_pre + dplagoal_pre +
    dteamred_pre + dteaminj_sec_pre +
    team_avespeed_pre_c +
    team_crowd_c + opp_crowd_c +
    p_odds_team_c + p_odds_draw_c +
    (1 | player) +
    (1 | gamenu) +
    (1 | section),
  data    = data_col4,
  family  = bernoulli(link = "logit"),
  prior   = priors_col4,
  chains  = 4, iter = 2000, warmup = 1000, cores = 4
)
```

```{r}
summary(m_col4_hier)
pp_check(m_col4_hier, ndraws = 100)
conditional_effects(m_col4_hier, spaghetti = TRUE, ndraws = 200)
plot(m_col4_hier)
```

```{r}
m_col5_hier <- brm(
  dplagoal ~
    playersprints_c +
    dhomegame + rank_gap_c +
    player_cumsections_c + player_cumsections_2_c +
    scoregap_pre_c + dteamgoal_pre + dplagoal_pre +
    dteamred_pre + dteaminj_sec_pre +
    team_avespeed_pre_c +
    (1 | player) +
    (1 | gamenu) +
    (1 | section),
  data    = data_col356,
  family  = bernoulli(link = "logit"),
  prior   = priors_col5,
  chains  = 4, iter = 2000, warmup = 1000, cores = 4
)
```

```{r}
summary(m_col5_hier)
pp_check(m_col5_hier, ndraws = 100)
conditional_effects(m_col5_hier, spaghetti = TRUE, ndraws = 200)
plot(m_col5_hier)
```

```{r}
m_col6_hier <- brm(
  dplagoal ~
    plaavspeed_c + playersprints_c +
    dhomegame + rank_gap_c +
    player_cumsections_c + player_cumsections_2_c +
    scoregap_pre_c + dteamgoal_pre + dplagoal_pre +
    dteamred_pre + dteaminj_sec_pre +
    team_avespeed_pre_c +
    (1 | player) +
    (1 | gamenu) +
    (1 | section),
  data    = data_col356,
  family  = bernoulli(link = "logit"),
  prior   = priors_col6,
  chains  = 4, iter = 2000, warmup = 1000, cores = 4
)
```

```{r}
summary(m_col6_hier)
pp_check(m_col6_hier, ndraws = 100)
conditional_effects(m_col6_hier, spaghetti = TRUE, ndraws = 200)
plot(m_col6_hier)
```

```{r}
m_col7_hier <- brm(
  formula = goal_game ~
    plaavspeed_game_c + dhomegame + rank_gap_c +
    (1 | player) +
    (1 | gamenu),
  data    = data_col7,
  family  = bernoulli(link = "logit"),
  prior   = priors_col7,
  chains  = 4, iter = 2000, warmup = 1000, cores = 4
)
```

```{r}
summary(m_col7_hier)
pp_check(m_col7_hier, ndraws = 100)
conditional_effects(m_col7_hier, spaghetti = TRUE, ndraws = 200)
plot(m_col7_hier)
```


